<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>AKARI 導入手順書</title>
<link rel="stylesheet" href="http://akari.sourceforge.jp/akari.css" media="all" type="text/css">
</head>
<body>
<p style="text-align:right;"><a href="install.html.en">English Page</a></p>
<p style="text-align:right;">Last modified: $Date$</p>
<h1>第１章：カーネルモジュールとツールのインストール</h1>

<p>このページでは、 AKARI カーネルモジュールとツールをインストールする手順について説明します。</p>

<hr>

<h2>ステップ１：カーネルモジュールのインストール</h2>

<p>カーネルモジュールとツールのコンパイルに必要なパッケージをインストールしてください。</p>

<table border="1">
<tr><td>RedHat 系の場合</td><td>
# yum -y install gcc ncurses-devel wget make
</td></tr>
<tr><td>Debian 系の場合</td><td>
# apt-get -y install gcc libncurses-dev wget make
</td></tr>
</table>

<p>次に、カーネルの開発用パッケージをインストールして、そのディレクトリに移動してください。</p>

<table border="1">
<tr><td>RedHat 系の場合</td><td>
# VERSION=`uname -r`<br>
# yum -y install kernel-devel-${VERSION}<br>
# cd /usr/src/kernels/${VERSION}*/
</td></tr>
<tr><td>Debian 系の場合</td><td>
# VERSION=`uname -r`<br>
# apt-get -y install linux-headers-${VERSION}<br>
# cd /usr/src/linux-headers-${VERSION}/
</td></tr>
</table>

<p>次に、以下のコマンドを実行して AKARI カーネルモジュールをインストールしてください。</p>

<table border="1">
<tr><td>
# wget -O akari-1.0.6-20101231.tar.gz 'http://sourceforge.jp/frs/redir.php?f=/akari/49272/akari-1.0.6-20101231.tar.gz'<br>
# wget -O akari-1.0.6-20101231.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?f=/akari/49272/akari-1.0.6-20101231.tar.gz.asc'<br>
# gpg akari-1.0.6-20101231.tar.gz.asc<br>
# tar -zxf akari-1.0.6-20101231.tar.gz<br>
# make SUBDIRS=akari modules<br>
# make SUBDIRS=akari modules_install<br>
# depmod ${VERSION}
</td></tr>
</table>

<p>もし、</p>

<pre>
You must choose CONFIG_SECURITY=y for building this module.
You must choose CONFIG_KALLSYMS=y for building this module.
You must choose CONFIG_PROC_FS=y for building this module.
You must choose CONFIG_MODULES=y for building this module.
This version is not supported because I cannot resolve vfsmount_lock .
</pre>

<p>の何れかのエラーメッセージが表示された場合、ご利用のカーネルは AKARI に対応できませんのでご了承ください。その他のエラーメッセージが表示された場合は作者（ penguin-kernel&#64;I-love.SAKURA.ne.jp ）にご連絡ください。</p>

<p>もし、ご利用のカーネルでサポートされている機能や構文について知りたい場合には <a href="comparison.html.ja">AKARI / TOMOYO 機能比較表</a> を参照してください。</li></p>

<hr>

<h2>ステップ２：ツールのインストール</h2>

<p>ツールのコンパイル時に利用可能であることが望ましいパッケージをインストールしてください。（インストールできなくてもそのまま続行して構いません。）</p>

<table border="1">
<tr><td>RedHat 系の場合</td><td>
# yum -y install readline-devel help2man
</td></tr>
<tr><td>Debian 系の場合</td><td>
# apt-get -y install libreadline-dev help2man
</td></tr>
</table>

<p>次に、以下のコマンドを実行してツールをインストールしてください。</p>

<table border="1">
<tr><td>
# cd /tmp/<br>
# wget -O ccs-tools-1.8.0-20101231.tar.gz 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/49693/ccs-tools-1.8.0-20101231.tar.gz'<br>
# wget -O ccs-tools-1.8.0-20101231.tar.gz.asc 'http://sourceforge.jp/frs/redir.php?f=/tomoyo/49693/ccs-tools-1.8.0-20101231.tar.gz.asc'<br>
# gpg ccs-tools-1.8.0-20101231.tar.gz.asc<br>
# tar -zxf ccs-tools-1.8.0-20101231.tar.gz<br>
# cd ccstools/<br>
# make -s<br>
# make -s install<br>
# ldconfig
</td></tr>
</table>

<hr>

<h2>ステップ３：起動設定のアップデート</h2>

<p>init=/sbin/ccs-init というパラメータをカーネル起動時のコマンドラインに追加してください。以下に例を示します。</p>

<table border="1">
<tr><td>変更前</td><td>
title CentOS (2.6.18-194.26.1.el5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root (hd0,0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel /boot/vmlinuz-2.6.18-194.26.1.el5 ro root=LABEL=/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initrd /boot/initrd-2.6.18-194.26.1.el5.img
</td></tr>
<tr><td>変更後</td><td>
title CentOS (2.6.18-194.26.1.el5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root (hd0,0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel /boot/vmlinuz-2.6.18-194.26.1.el5 ro root=LABEL=/ init=/sbin/ccs-init<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initrd /boot/initrd-2.6.18-194.26.1.el5.img
</td></tr>
</table>

<p>AKARI はＬＳＭモジュールですが、他のＬＳＭモジュールと同時に利用することができます。しかし、 /etc/selinux/config に SELINUX=disabled という指定を行うことにより SELinux を無効にしている場合には、以下のように selinux=0 も追加する必要があります。これは、 /etc/selinux/config の中で SELINUX=disabled という指定が行われている場合、 AKARI が依存しているＬＳＭフックを /sbin/init が無効化してしまうためです。</p>

<table border="1">
<tr><td>変更前</td><td>
title CentOS (2.6.18-194.26.1.el5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root (hd0,0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel /boot/vmlinuz-2.6.18-194.26.1.el5 ro root=LABEL=/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initrd /boot/initrd-2.6.18-194.26.1.el5.img
</td></tr>
<tr><td>変更後</td><td>
title CentOS (2.6.18-194.26.1.el5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root (hd0,0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel /boot/vmlinuz-2.6.18-194.26.1.el5 ro root=LABEL=/ selinux=0 init=/sbin/ccs-init<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initrd /boot/initrd-2.6.18-194.26.1.el5.img
</td></tr>
</table>

<p>AKARI をアンインストールしたい場合、 init=/sbin/ccs-init というパラメータをカーネル起動時のコマンドラインから削除して再起動してください。</p>

<hr>

<p><a href="index.html.ja">目次へ戻る</a></p>
<p><a href="http://sourceforge.jp/"><img src="http://sourceforge.jp/sflogo.php?group_id=1973" width="96" height="31" alt="SourceForge.jp"></a></p>
</body>
</html>
